<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.customer.controller.ReportController"
           styleClass="content-view">

    <VBox spacing="20">
        <padding>
            <Insets top="20" right="20" bottom="20" left="20"/>
        </padding>

        <!-- Header -->
        <HBox alignment="CENTER_LEFT" spacing="15">
            <Label text="Reports &amp; Analytics" styleClass="page-title"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <!-- Main Content -->
        <TabPane fx:id="reportTabPane" tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS">

            <!-- Tab 1: Dashboard Overview -->
            <Tab text="Dashboard Overview" closable="false">
                <ScrollPane fitToWidth="true" styleClass="edge-to-edge">
                    <VBox spacing="20">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>

                        <!-- Summary Cards -->
                        <HBox spacing="20" alignment="CENTER">
                            <!-- Card 1 -->
                            <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                                <Label text="Total Customers" styleClass="stat-label"/>
                                <Label fx:id="lblTotalCustomers" text="0" styleClass="stat-value"/>
                                <Label fx:id="lblCustomerChange" text="+0%" styleClass="stat-change"/>
                            </VBox>

                            <!-- Card 2 -->
                            <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                                <Label text="Total Balance" styleClass="stat-label"/>
                                <Label fx:id="lblTotalBalance" text="0 VND" styleClass="stat-value"/>
                                <Label fx:id="lblBalanceChange" text="+0%" styleClass="stat-change"/>
                            </VBox>

                            <!-- Card 3 -->
                            <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                                <Label text="Total Loans (Outstanding)" styleClass="stat-label"/>
                                <Label fx:id="lblTotalLoans" text="0 VND" styleClass="stat-value"/>
                            </VBox>

                            <!-- Card 4 -->
                            <VBox styleClass="stat-card" HBox.hgrow="ALWAYS">
                                <Label text="Today's Transactions" styleClass="stat-label"/>
                                <Label fx:id="lblTodayTransactions" text="0" styleClass="stat-value"/>
                            </VBox>
                        </HBox>

                        <!-- Charts Row 1 -->
                        <HBox spacing="20" prefHeight="300">
                            <PieChart fx:id="customerDistChart" title="Customer Distribution" HBox.hgrow="ALWAYS" legendSide="RIGHT"/>
                            <PieChart fx:id="accountTypeChart" title="Account Types" HBox.hgrow="ALWAYS" legendSide="RIGHT"/>
                        </HBox>

                        <!-- Charts Row 2 -->
                        <HBox spacing="20" prefHeight="300">
                            <BarChart fx:id="transactionBarChart" title="Transaction Trend (6 Months)" HBox.hgrow="ALWAYS">
                                <xAxis><CategoryAxis label="Month"/></xAxis>
                                <yAxis><NumberAxis label="Count"/></yAxis>
                            </BarChart>
                            <BarChart fx:id="loanStatusChart" title="Loan Status" HBox.hgrow="ALWAYS">
                                <xAxis><CategoryAxis label="Status"/></xAxis>
                                <yAxis><NumberAxis label="Count"/></yAxis>
                            </BarChart>
                        </HBox>

                        <!-- Charts Row 3 -->
                        <HBox spacing="20" prefHeight="300">
                             <LineChart fx:id="balanceTrendChart" title="Balance Net Flow Trend" HBox.hgrow="ALWAYS">
                                <xAxis><CategoryAxis label="Month"/></xAxis>
                                <yAxis><NumberAxis label="Net Amount"/></yAxis>
                            </LineChart>
                        </HBox>

                        <!-- Top Accounts Table -->
                        <VBox spacing="10">
                            <Label text="Top Accounts by Balance" styleClass="section-header"/>
                            <TableView fx:id="topAccountsTable" prefHeight="200">
                                <columns>
                                    <TableColumn fx:id="colAccNumber" text="Account Number"/>
                                    <TableColumn fx:id="colAccCustomer" text="Customer Name"/>
                                    <TableColumn fx:id="colAccType" text="Type"/>
                                    <TableColumn fx:id="colAccBalance" text="Balance"/>
                                    <TableColumn fx:id="colAccStatus" text="Status"/>
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                                </columnResizePolicy>
                            </TableView>
                        </VBox>

                        <HBox alignment="CENTER_RIGHT">
                            <Button fx:id="exportDashboardBtn" text="ðŸ“„ Export PDF" onAction="#handleExportDashboard" styleClass="action-button"/>
                        </HBox>
                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- Tab 2: Transaction Report -->
            <Tab text="Transaction Report" closable="false">
                <VBox spacing="15">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <!-- Filters -->
                    <HBox spacing="15" alignment="CENTER_LEFT" styleClass="filter-bar">
                        <Label text="From:"/>
                        <DatePicker fx:id="txnFromDate" prefWidth="120"/>
                        <Label text="To:"/>
                        <DatePicker fx:id="txnToDate" prefWidth="120"/>
                        <ComboBox fx:id="txnTypeFilter" promptText="All Types" prefWidth="150"/>
                        <ComboBox fx:id="txnAccountFilter" promptText="All Accounts" prefWidth="200"/>
                        <Button fx:id="generateTxnReportBtn" text="Generate Report" onAction="#handleGenerateTxnReport" styleClass="primary-button"/>
                    </HBox>

                    <!-- Summary -->
                    <HBox spacing="30" styleClass="summary-bar">
                        <Label fx:id="lblTxnCount" text="Total Count: 0" style="-fx-font-weight: bold;"/>
                        <Label fx:id="lblTxnTotal" text="Total Amount: 0 VND" style="-fx-font-weight: bold;"/>
                    </HBox>

                    <!-- Table -->
                    <TableView fx:id="txnReportTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colTxnDate" text="Date"/>
                            <TableColumn fx:id="colTxnRef" text="Reference"/>
                            <TableColumn fx:id="colTxnAccount" text="Account"/>
                            <TableColumn fx:id="colTxnType" text="Type"/>
                            <TableColumn fx:id="colTxnAmount" text="Amount"/>
                            <TableColumn fx:id="colTxnTarget" text="Target/Source"/>
                            <TableColumn fx:id="colTxnDesc" text="Description"/>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>

                    <HBox alignment="CENTER_RIGHT">
                        <Button fx:id="exportTxnReportBtn" text="ðŸ“„ Export PDF" onAction="#handleExportTxnReport" disable="true" styleClass="action-button"/>
                    </HBox>
                </VBox>
            </Tab>

            <!-- Tab 3: Loan Portfolio Report -->
            <Tab text="Loan Portfolio" closable="false">
                <VBox spacing="15">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <!-- Filters -->
                    <HBox spacing="15" alignment="CENTER_LEFT" styleClass="filter-bar">
                        <Label text="From:"/>
                        <DatePicker fx:id="loanFromDate" prefWidth="120"/>
                        <Label text="To:"/>
                        <DatePicker fx:id="loanToDate" prefWidth="120"/>
                        <ComboBox fx:id="loanStatusFilter" promptText="All Status" prefWidth="150"/>
                        <Button fx:id="generateLoanReportBtn" text="Generate Report" onAction="#handleGenerateLoanReport" styleClass="primary-button"/>
                    </HBox>

                    <!-- Summary -->
                    <HBox spacing="30" styleClass="summary-bar">
                        <Label fx:id="lblLoanCount" text="Total Loans: 0" style="-fx-font-weight: bold;"/>
                        <Label fx:id="lblLoanOutstanding" text="Total Outstanding: 0 VND" style="-fx-font-weight: bold;"/>
                    </HBox>

                    <!-- Table -->
                    <TableView fx:id="loanReportTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colLoanId" text="ID"/>
                            <TableColumn fx:id="colLoanCustomer" text="Customer"/>
                            <TableColumn fx:id="colLoanAmount" text="Amount"/>
                            <TableColumn fx:id="colLoanStart" text="Start Date"/>
                            <TableColumn fx:id="colLoanTerm" text="Term (M)"/>
                            <TableColumn fx:id="colLoanStatus" text="Status"/>
                        </columns>
                         <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>

                    <HBox alignment="CENTER_RIGHT">
                        <Button fx:id="exportLoanReportBtn" text="ðŸ“„ Export PDF" onAction="#handleExportLoanReport" disable="true" styleClass="action-button"/>
                    </HBox>
                </VBox>
            </Tab>

            <!-- Tab 4: Account Statement -->
            <Tab text="Account Statement" closable="false">
                <VBox spacing="15">
                     <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <!-- Filters -->
                    <HBox spacing="15" alignment="CENTER_LEFT" styleClass="filter-bar">
                        <Label text="Account:"/>
                        <ComboBox fx:id="stmtAccountCombo" promptText="Select Account" prefWidth="250"/>
                        <Label text="From:"/>
                        <DatePicker fx:id="stmtFromDate" prefWidth="120"/>
                        <Label text="To:"/>
                        <DatePicker fx:id="stmtToDate" prefWidth="120"/>
                        <Button fx:id="generateStmtBtn" text="Generate Statement" onAction="#handleGenerateStatement" styleClass="primary-button"/>
                    </HBox>

                    <!-- Summary -->
                    <GridPane hgap="20" vgap="10" styleClass="summary-grid">
                        <Label text="Opening Balance:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <Label fx:id="lblStmtOpening" text="0 VND" style="-fx-font-weight: bold;" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                        <Label text="Total In:" GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                        <Label fx:id="lblStmtIn" text="0 VND" style="-fx-text-fill: green;" GridPane.columnIndex="3" GridPane.rowIndex="0"/>

                        <Label text="Total Out:" GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                        <Label fx:id="lblStmtOut" text="0 VND" style="-fx-text-fill: red;" GridPane.columnIndex="3" GridPane.rowIndex="1"/>

                        <Label text="Closing Balance:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        <Label fx:id="lblStmtClosing" text="0 VND" style="-fx-font-weight: bold; -fx-font-size: 14px;" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                    </GridPane>

                    <!-- Table -->
                    <TableView fx:id="stmtTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colStmtDate" text="Date"/>
                            <TableColumn fx:id="colStmtRef" text="Reference"/>
                            <TableColumn fx:id="colStmtDesc" text="Description"/>
                            <TableColumn fx:id="colStmtDebit" text="Debit (-)"/>
                            <TableColumn fx:id="colStmtCredit" text="Credit (+)"/>
                        </columns>
                         <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>

                    <HBox alignment="CENTER_RIGHT">
                        <Button fx:id="exportStatementBtn" text="ðŸ“„ Export PDF" onAction="#handleExportStatement" disable="true" styleClass="action-button"/>
                    </HBox>
                </VBox>
            </Tab>

        </TabPane>
    </VBox>

    <!-- Loading Overlay -->
    <StackPane fx:id="loadingOverlay" styleClass="loading-overlay" visible="false" managed="false">
        <VBox alignment="CENTER" spacing="10" style="-fx-background-color: rgba(255,255,255,0.8); -fx-background-radius: 10; -fx-padding: 20;">
            <ProgressIndicator/>
            <Label text="Loading data..."/>
        </VBox>
    </StackPane>

</StackPane>
